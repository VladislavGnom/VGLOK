{% extends 'mainapp/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="user-card">
    <div class="user-avatar">
        <img src="{{ user.avatar.url }}" alt="avatar-{{ user.username }}" style="max-height: 40px; max-width: 40px;">
    </div>
    <div class="user-maindata">
        <span class="h3">{{ user.first_name }} {{ user.last_name }}</span>
        <div>
            {% if user.short_description %}
                Описание: {{ user.short_description }}
            {% endif %}
        </div>
    </div>
    <div>
        {% if request.user.username != user.username %}
        <a href="{% url 'personal_chat_room' user.pk %}">
            <button class="btn btn-primary">Написать</button>
        </a>
        {% else %}
        <a href="{% url 'create_post' %}">
            <button class="btn btn-primary">Создать пост</button>
        </a>
        {% endif %}
    </div>
</div>
<div class="user-posts">
    {% for post in posts %}
        <div class="user-post card">
            {% if post.image %}
            <img src="{{ post.image.url }}" alt="user-post-{{ post.pk }}">
            {% else %}
            {% endif %}
            {{ post.description }}
        </div>
        <div>
            Лайки: 
            <button type="button">
                {{ post.likes }}    
            </button>
            <div class="comments-block">
                Комментарии:
                {% if post.comments %}
                <ul>
                    {% for comment in post.comments.all %}
                        <li>{{ comment.author.username }}: {{ comment.text }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                Пока нет комментариев
                {% endif %}

                <form action="{% url 'handle_comment' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="post-pk" value="{{ post.pk }}">
                    <input type="hidden" name="current-location" value="{{ request.scope.path }}">
                    {{ comment_form }}
                    <button type="submit">Отправить</button>
                </form>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}
